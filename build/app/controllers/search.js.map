{"version":3,"sources":["../src/app/controllers/search.js"],"names":["axios","require","lunr","textProcessing","empty","cSearch","searchAction","req","res","next","keyword","body","businessModel","location","roundInvestment","vertical","yearEstablished","console","log","get","then","response","documents","data","idx","field","forEach","doc","add","Array","isArray","length","arr","join","q","removeStopwordsID","replace","ret","search","resLunr","resLunrScore","i","push","ref","score","dt","finalRet","pass","includes","id","index","indexOf","city","lastRound","x","category","name","description","descriptionEn","country","notes","website","avatar","urlNews","operationStatus","provenRevenueModel","provenBusinessModel","editorialRating","investment","founder","sort","a","b","parseFloat","editorChoice","status","json","statusCode","success","catch","error","message","searchEnAction","lunrAction","string","module","exports"],"mappings":"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","file":"search.js","sourcesContent":["const axios = require('axios');\nconst lunr = require('lunr');\n\nvar textProcessing = require('../models/textprocess');\nvar empty = require('is-empty');\n \nfunction cSearch() {\n  \n  this.searchAction = function(req,res,next) {\n\n    var keyword = req.body.keyword;\n    var businessModel = req.body.businessModel;\n    var location = req.body.location;\n    var roundInvestment = req.body.roundInvestment;\n    var vertical = req.body.vertical;\n    var yearEstablished = req.body.yearEstablished;\n\n    console.log(keyword);\n    console.log(businessModel);\n    console.log(location);\n    console.log(roundInvestment);\n    console.log(vertical);\n    console.log(yearEstablished);\n\n    axios.get('https://minerva.dailysocial.id/sampoerna.json')\n      .then(response => {\n\n        var documents = response.data;\n\n        var idx = lunr(function () {\n          this.field('name')\n          this.field('description')\n          this.field('city')\n          this.field('category')\n          this.field('yearEstablished')\n          this.field('businessModel')\n          this.field('lastRound')\n          //this.ref('name')\n\n          documents.forEach(function (doc) {\n            this.add(doc)\n          }, this)\n         \n        });\n\n        if(!empty(keyword)){\n\n          if(Array.isArray(keyword)){\n\n            if(keyword.length > 1){\n              var arr = keyword.join(\" \");\n              var q = textProcessing.removeStopwordsID(arr);\n              q = q.replace(/gudang/g, \"*gudang*\");\n              q = q.replace(/ecommerce/g, \"e-commerce\");\n            }else{\n              var q = textProcessing.removeStopwordsID(keyword[0]);\n              q = q.replace(/gudang/g, \"*gudang*\");\n              q = q.replace(/ecommerce/g, \"e-commerce\");\n            }\n\n          }else{\n\n            var q = textProcessing.removeStopwordsID(keyword);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n          }\n\n        }else{\n          var q = \"\";\n        }\n\n        console.log(q);\n\n        var ret = idx.search(q);\n\n        var resLunr = [];\n        var resLunrScore = [];\n\n        for (var i = 0; i < ret.length; i++) {\n          resLunr.push(ret[i].ref);\n          resLunrScore.push(ret[i].score);\n\n        }\n\n        var dt = response.data;\n        var finalRet = [];\n\n        for (var i = 0; i < dt.length; i++) {\n\n          var pass = {\n              businessModel: true, \n              keyword: true, \n              location: true, \n              roundInvestment: true, \n              vertical: true, \n              yearEstablished: true\n          };\n          \n          if(resLunr.includes(dt[i].id)){\n\n            var index = resLunr.indexOf(dt[i].id);\n            var score = resLunrScore[index];\n\n            if (!empty(businessModel)) {\n                if (!businessModel.includes(dt[i].businessModel)) {\n                    pass.businessModel = false;\n                } else {\n                    pass.businessModel = true;                                    \n                }\n            }\n\n            if (!empty(location)) {\n                if (!location.includes(dt[i].city)) {\n                    pass.location = false;\n                } else {\n                    pass.location = true;                                    \n                }\n            }\n\n            if (!empty(roundInvestment)) {\n                if (!roundInvestment.includes(dt[i].lastRound)) {\n                    pass.roundInvestment = false;\n                } else {\n                    pass.roundInvestment = true;                                    \n                }\n            }\n\n            if (!empty(vertical)) {\n                for (var x=0;x<vertical.length;x++) {\n                    if (!dt[i].category.includes(vertical[x])) {\n                        pass.vertical = false;\n                    } else {\n                        pass.vertical = true;\n                        break;                                        \n                    }\n                }\n            }\n\n            if (!empty(yearEstablished)) {\n                if (!yearEstablished.includes(dt[i].yearEstablished)) {\n                    pass.yearEstablished = false;\n                } else {\n                    pass.yearEstablished = true;                                    \n                }\n            }\n\n            if (pass.businessModel == true && pass.location == true && pass.roundInvestment == true && pass.vertical == true && pass.yearEstablished == true) {\n\n              finalRet.push({\n                \"id\": dt[i].id,\n                \"name\": dt[i].name,\n                \"description\": dt[i].description,\n                \"descriptionEn\": dt[i].descriptionEn,\n                \"city\": dt[i].city,\n                \"country\": dt[i].country,\n                \"category\": dt[i].category,\n                \"yearEstablished\": dt[i].yearEstablished,\n                \"notes\": dt[i].notes,\n                \"website\": dt[i].website,\n                \"avatar\": dt[i].avatar,\n                \"urlNews\": dt[i].urlNews,\n                \"operationStatus\": dt[i].operationStatus,\n                \"businessModel\": dt[i].businessModel,\n                \"provenRevenueModel\": dt[i].provenRevenueModel,\n                \"provenBusinessModel\": dt[i].provenBusinessModel,\n                \"editorialRating\": dt[i].editorialRating,\n                \"investment\": dt[i].investment,\n                \"lastRound\": dt[i].lastRound,\n                \"founder\": dt[i].founder,\n                \"score\": score,\n                \"editorChoice\": empty(dt[i].provenBusinessModel) ? 0 : 1\n\n              });\n            }\n\n          } \n        }\n\n        finalRet.sort(function(a, b) {\n            //return parseFloat(b.score) - parseFloat(a.score);\n            //return a.provenBusinessModel < b.provenBusinessModel;\n            return parseFloat(b.editorChoice) - parseFloat(a.editorChoice);\n        });\n\n        return res.status(200).json({statusCode:200,success:true,data:finalRet});\n      })\n      .catch(error => {\n        console.log(error);\n        return res.status(500).json({statusCode:500,message: \"Read search failed.\"});\n      });\n  };\n\n  this.searchEnAction = function(req,res,next) {\n\n    var keyword = req.body.keyword;\n    var businessModel = req.body.businessModel;\n    var location = req.body.location;\n    var roundInvestment = req.body.roundInvestment;\n    var vertical = req.body.vertical;\n    var yearEstablished = req.body.yearEstablished;\n\n    console.log(keyword);\n    console.log(businessModel);\n    console.log(location);\n    console.log(roundInvestment);\n    console.log(vertical);\n    console.log(yearEstablished);\n\n    axios.get('https://minerva.dailysocial.id/sampoerna.json')\n      .then(response => {\n\n        var documents = response.data;\n\n        var idx = lunr(function () {\n          this.field('name')\n          this.field('descriptionEn')\n          this.field('city')\n          this.field('category')\n          this.field('yearEstablished')\n          this.field('businessModel')\n          this.field('lastRound')\n          //this.ref('name')\n\n          documents.forEach(function (doc) {\n            this.add(doc)\n          }, this)\n         \n        });\n\n        if(!empty(keyword)){\n\n          if(Array.isArray(keyword)){\n\n            if(keyword.length > 1){\n              var arr = keyword.join(\" \");\n              var q = textProcessing.removeStopwordsID(arr);\n              q = q.replace(/gudang/g, \"*gudang*\");\n              q = q.replace(/ecommerce/g, \"e-commerce\");\n            }else{\n              var q = textProcessing.removeStopwordsID(keyword[0]);\n              q = q.replace(/gudang/g, \"*gudang*\");\n              q = q.replace(/ecommerce/g, \"e-commerce\");\n            }\n\n          }else{\n\n            var q = textProcessing.removeStopwordsID(keyword);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n          }\n\n        }else{\n          var q = \"\";\n        }\n\n        console.log(q);\n\n        var ret = idx.search(q);\n\n        var resLunr = [];\n        var resLunrScore = [];\n\n        for (var i = 0; i < ret.length; i++) {\n          resLunr.push(ret[i].ref);\n          resLunrScore.push(ret[i].score);\n\n        }\n\n        var dt = response.data;\n        var finalRet = [];\n\n        for (var i = 0; i < dt.length; i++) {\n\n          var pass = {\n              businessModel: true, \n              keyword: true, \n              location: true, \n              roundInvestment: true, \n              vertical: true, \n              yearEstablished: true\n          };\n          \n          if(resLunr.includes(dt[i].id)){\n\n            var index = resLunr.indexOf(dt[i].id);\n            var score = resLunrScore[index];\n\n            if (!empty(businessModel)) {\n                if (!businessModel.includes(dt[i].businessModel)) {\n                    pass.businessModel = false;\n                } else {\n                    pass.businessModel = true;                                    \n                }\n            }\n\n            if (!empty(location)) {\n                if (!location.includes(dt[i].city)) {\n                    pass.location = false;\n                } else {\n                    pass.location = true;                                    \n                }\n            }\n\n            if (!empty(roundInvestment)) {\n                if (!roundInvestment.includes(dt[i].lastRound)) {\n                    pass.roundInvestment = false;\n                } else {\n                    pass.roundInvestment = true;                                    \n                }\n            }\n\n            if (!empty(vertical)) {\n                for (var x=0;x<vertical.length;x++) {\n                    if (!dt[i].category.includes(vertical[x])) {\n                        pass.vertical = false;\n                    } else {\n                        pass.vertical = true;\n                        break;                                        \n                    }\n                }\n            }\n\n            if (!empty(yearEstablished)) {\n                if (!yearEstablished.includes(dt[i].yearEstablished)) {\n                    pass.yearEstablished = false;\n                } else {\n                    pass.yearEstablished = true;                                    \n                }\n            }\n\n            if (pass.businessModel == true && pass.location == true && pass.roundInvestment == true && pass.vertical == true && pass.yearEstablished == true) {\n\n              finalRet.push({\n                \"id\": dt[i].id,\n                \"name\": dt[i].name,\n                \"description\": dt[i].description,\n                \"descriptionEn\": dt[i].descriptionEn,\n                \"city\": dt[i].city,\n                \"country\": dt[i].country,\n                \"category\": dt[i].category,\n                \"yearEstablished\": dt[i].yearEstablished,\n                \"notes\": dt[i].notes,\n                \"website\": dt[i].website,\n                \"avatar\": dt[i].avatar,\n                \"urlNews\": dt[i].urlNews,\n                \"operationStatus\": dt[i].operationStatus,\n                \"businessModel\": dt[i].businessModel,\n                \"provenRevenueModel\": dt[i].provenRevenueModel,\n                \"provenBusinessModel\": dt[i].provenBusinessModel,\n                \"editorialRating\": dt[i].editorialRating,\n                \"investment\": dt[i].investment,\n                \"lastRound\": dt[i].lastRound,\n                \"founder\": dt[i].founder,\n                \"score\": score,\n                \"editorChoice\": empty(dt[i].provenBusinessModel) ? 0 : 1\n              });\n            }\n\n          } \n        }\n\n        finalRet.sort(function(a, b) {\n            //return parseFloat(b.score) - parseFloat(a.score);\n            //return a.provenBusinessModel < b.provenBusinessModel;\n            return parseFloat(b.editorChoice) - parseFloat(a.editorChoice);\n        });\n\n        return res.status(200).json({statusCode:200,success:true,data:finalRet});\n      })\n      .catch(error => {\n        console.log(error);\n        return res.status(500).json({statusCode:500,message: \"Read search failed.\"});\n      });\n  };\n\n  this.lunrAction = function(req,res,next) {\n\n    var documents = \n    [\n      {\n        \"title\": \"Tokopedia\",\n        \"body\": \"Tokopedia adalah marketplace terbesar di Indonesia\",\n        \"founder\": \"William\",\n        \"year\": [\"2014\",\"2017\"],\n        \"id\": \"0jkuyvbc78m\"\n      }, \n      {\n        \"title\": \"Traveloka\",\n        \"body\": \"Traveloka adalah platform hospitality di Indonesia\",\n        \"author\": \"Bagus Rinaldhi\",\n        \"year\": [\"2015\",\"2017\"],\n        \"id\": \"0jkuyvbc78r\"\n      }, \n      {\n        \"title\": \"Lazada\",\n        \"body\": \"Lazada merupakan platform e-commerce yang memberikan layanan gratis ongkir\",\n        \"author\": \"Bens\",\n        \"year\": [\"2016\",\"2018\"],\n        \"id\": \"0jkuyvbc78f\"\n      }\n    ]\n\n\n    var idx = lunr(function () {\n      this.field('title')\n      this.field('body')\n      this.field('year');\n\n      documents.forEach(function (doc) {\n        this.add(doc)\n      }, this)\n     \n    });\n\n    var string = \"saya ingin tahu startup hospitality 2018 2014 2015\";\n\n    var ret = idx.search(\"saya ingin tahu startup hospitality 2018 2014 2015\");\n\n    var x = textProcessing.removeStopwordsID(string)\n\n    return res.status(200).json({statusCode:200,success:true,data:x});\n\n  };\n\n  \n\n}\nmodule.exports = new cSearch();"]}