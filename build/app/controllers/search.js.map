{"version":3,"sources":["../src/app/controllers/search.js"],"names":["axios","require","lunr","textProcessing","empty","cSearch","searchAction","req","res","next","keyword","body","businessModel","location","roundInvestment","vertical","yearEstablished","get","then","response","documents","data","idx","field","forEach","doc","add","removeStopwordsID","replace","ret","search","resLunr","resLunrScore","i","length","push","ref","score","dt","finalRet","pass","includes","id","index","indexOf","city","lastRound","x","category","name","description","country","notes","website","avatar","urlNews","operationStatus","investment","founder","sort","a","b","parseFloat","status","json","statusCode","success","catch","error","console","log","message","lunrAction","string","module","exports"],"mappings":"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","file":"search.js","sourcesContent":["const axios = require('axios');\nconst lunr = require('lunr');\n\nvar textProcessing = require('../models/textprocess');\nvar empty = require('is-empty');\n \nfunction cSearch() {\n  \n  this.searchAction = function(req,res,next) {\n\n    var keyword = req.body.keyword;\n    var businessModel = req.body.businessModel;\n    var location = req.body.location;\n    var roundInvestment = req.body.roundInvestment;\n    var vertical = req.body.vertical;\n    var yearEstablished = req.body.yearEstablished;\n\n    axios.get('https://minerva.dailysocial.id/sampoerna.json')\n      .then(response => {\n\n        var documents = response.data;\n\n        var idx = lunr(function () {\n          this.field('name')\n          this.field('description')\n          this.field('city')\n          this.field('category')\n          this.field('yearEstablished')\n          this.field('businessModel')\n          this.field('lastRound')\n          //this.ref('name')\n\n          documents.forEach(function (doc) {\n            this.add(doc)\n          }, this)\n         \n        });\n\n        keyword = textProcessing.removeStopwordsID(keyword)\n        keyword = keyword.replace(/gudang/g, \"*gudang*\");\n        keyword = keyword.replace(/ecommerce/g, \"e-commerce\");\n\n        var ret = idx.search(keyword);\n\n        var resLunr = [];\n        var resLunrScore = [];\n\n        for (var i = 0; i < ret.length; i++) {\n          resLunr.push(ret[i].ref);\n          resLunrScore.push(ret[i].score);\n\n        }\n\n        var dt = response.data;\n        var finalRet = [];\n\n        for (var i = 0; i < dt.length; i++) {\n\n          var pass = {\n              businessModel: true, \n              keyword: true, \n              location: true, \n              roundInvestment: true, \n              vertical: true, \n              yearEstablished: true\n          };\n          \n          if(resLunr.includes(dt[i].id)){\n\n            var index = resLunr.indexOf(dt[i].id);\n            var score = resLunrScore[index];\n\n            if (!empty(businessModel)) {\n                if (!businessModel.includes(dt[i].businessModel)) {\n                    pass.businessModel = false;\n                } else {\n                    pass.businessModel = true;                                    \n                }\n            }\n\n            if (!empty(location)) {\n                if (!location.includes(dt[i].city)) {\n                    pass.location = false;\n                } else {\n                    pass.location = true;                                    \n                }\n            }\n\n            if (!empty(roundInvestment)) {\n                if (!roundInvestment.includes(dt[i].lastRound)) {\n                    pass.roundInvestment = false;\n                } else {\n                    pass.roundInvestment = true;                                    \n                }\n            }\n\n            if (!empty(vertical)) {\n                for (var x=0;x<vertical.length;x++) {\n                    if (!dt[i].category.includes(vertical[x])) {\n                        pass.vertical = false;\n                    } else {\n                        pass.vertical = true;\n                        break;                                        \n                    }\n                }\n            }\n\n            if (!empty(yearEstablished)) {\n                if (!yearEstablished.includes(dt[i].yearEstablished)) {\n                    pass.yearEstablished = false;\n                } else {\n                    pass.yearEstablished = true;                                    \n                }\n            }\n\n            if (pass.businessModel == true && pass.location == true && pass.roundInvestment == true && pass.vertical == true && pass.yearEstablished == true) {\n\n              finalRet.push({\n                \"id\": dt[i].id,\n                \"name\": dt[i].name,\n                \"description\": dt[i].description,\n                \"city\": dt[i].city,\n                \"country\": dt[i].country,\n                \"category\": dt[i].category,\n                \"yearEstablished\": dt[i].yearEstablished,\n                \"notes\": dt[i].notes,\n                \"website\": dt[i].website,\n                \"avatar\": dt[i].avatar,\n                \"urlNews\": dt[i].urlNews,\n                \"operationStatus\": dt[i].operationStatus,\n                \"businessModel\": dt[i].businessModel,\n                \"investment\": dt[i].investment,\n                \"lastRound\": dt[i].lastRound,\n                \"founder\": dt[i].founder,\n                \"score\": score\n              });\n            }\n\n          } \n        }\n\n        finalRet.sort(function(a, b) {\n            return parseFloat(b.score) - parseFloat(a.score);\n        });\n\n        return res.status(200).json({statusCode:200,success:true,data:finalRet});\n      })\n      .catch(error => {\n        console.log(error);\n        return res.status(500).json({statusCode:500,message: \"Read search failed.\"});\n      });\n  };\n\n  this.lunrAction = function(req,res,next) {\n\n    var documents = \n    [\n      {\n        \"title\": \"Tokopedia\",\n        \"body\": \"Tokopedia adalah marketplace terbesar di Indonesia\",\n        \"founder\": \"William\",\n        \"year\": [\"2014\",\"2017\"],\n        \"id\": \"0jkuyvbc78m\"\n      }, \n      {\n        \"title\": \"Traveloka\",\n        \"body\": \"Traveloka adalah platform hospitality di Indonesia\",\n        \"author\": \"Bagus Rinaldhi\",\n        \"year\": [\"2015\",\"2017\"],\n        \"id\": \"0jkuyvbc78r\"\n      }, \n      {\n        \"title\": \"Lazada\",\n        \"body\": \"Lazada merupakan platform e-commerce yang memberikan layanan gratis ongkir\",\n        \"author\": \"Bens\",\n        \"year\": [\"2016\",\"2018\"],\n        \"id\": \"0jkuyvbc78f\"\n      }\n    ]\n\n\n    var idx = lunr(function () {\n      this.field('title')\n      this.field('body')\n      this.field('year');\n\n      documents.forEach(function (doc) {\n        this.add(doc)\n      }, this)\n     \n    });\n\n    var string = \"saya ingin tahu startup hospitality 2018 2014 2015\";\n\n    var ret = idx.search(\"saya ingin tahu startup hospitality 2018 2014 2015\");\n\n    var x = textProcessing.removeStopwordsID(string)\n\n    return res.status(200).json({statusCode:200,success:true,data:x});\n\n  };\n\n  \n\n}\nmodule.exports = new cSearch();"]}