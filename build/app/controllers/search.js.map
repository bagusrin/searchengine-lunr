{"version":3,"sources":["../src/app/controllers/search.js"],"names":["axios","require","lunr","textProcessing","empty","cSearch","searchAction","req","res","next","keyword","body","businessModel","location","roundInvestment","vertical","yearEstablished","get","then","response","documents","data","idx","field","forEach","doc","add","length","arr","join","console","log","q","removeStopwordsID","replace","ret","search","resLunr","resLunrScore","i","push","ref","score","dt","finalRet","pass","includes","id","index","indexOf","city","lastRound","x","category","name","description","descriptionEn","country","notes","website","avatar","urlNews","operationStatus","provenRevenueModel","provenBusinessModel","editorialRating","investment","founder","sort","a","b","status","json","statusCode","success","catch","error","message","searchEnAction","removeStopwordsEN","lunrAction","string","module","exports"],"mappings":"AAAA,MAAMA,QAAQC,QAAQ,OAAR,CAAd;AACA,MAAMC,OAAOD,QAAQ,MAAR,CAAb;;AAEA,IAAIE,iBAAiBF,QAAQ,uBAAR,CAArB;AACA,IAAIG,QAAQH,QAAQ,UAAR,CAAZ;;AAEA,SAASI,OAAT,GAAmB;;AAEjB,SAAKC,YAAL,GAAoB,UAASC,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAEzC,YAAIC,UAAUH,IAAII,IAAJ,CAASD,OAAvB;AACA,YAAIE,gBAAgBL,IAAII,IAAJ,CAASC,aAA7B;AACA,YAAIC,WAAWN,IAAII,IAAJ,CAASE,QAAxB;AACA,YAAIC,kBAAkBP,IAAII,IAAJ,CAASG,eAA/B;AACA,YAAIC,WAAWR,IAAII,IAAJ,CAASI,QAAxB;AACA,YAAIC,kBAAkBT,IAAII,IAAJ,CAASK,eAA/B;;AAEAhB,cAAMiB,GAAN,CAAU,+CAAV,EACGC,IADH,CACQC,YAAY;;AAEhB,gBAAIC,YAAYD,SAASE,IAAzB;;AAEA,gBAAIC,MAAMpB,KAAK,YAAY;AACzB,qBAAKqB,KAAL,CAAW,MAAX;AACA,qBAAKA,KAAL,CAAW,aAAX;AACA,qBAAKA,KAAL,CAAW,MAAX;AACA,qBAAKA,KAAL,CAAW,UAAX;AACA,qBAAKA,KAAL,CAAW,iBAAX;AACA,qBAAKA,KAAL,CAAW,eAAX;AACA,qBAAKA,KAAL,CAAW,WAAX;AACA;;AAEAH,0BAAUI,OAAV,CAAkB,UAAUC,GAAV,EAAe;AAC/B,yBAAKC,GAAL,CAASD,GAAT;AACD,iBAFD,EAEG,IAFH;AAID,aAdS,CAAV;;AAgBA,gBAAG,CAACrB,MAAMM,OAAN,CAAJ,EAAmB;;AAEjB,oBAAGA,QAAQiB,MAAR,GAAiB,CAApB,EAAsB;;AAEpB,wBAAIC,MAAMlB,QAAQmB,IAAR,CAAa,GAAb,CAAV;;AAEAC,4BAAQC,GAAR,CAAY,QAAMH,GAAlB;AACA,wBAAII,IAAI7B,eAAe8B,iBAAf,CAAiCL,GAAjC,CAAR;AACAI,wBAAIA,EAAEE,OAAF,CAAU,SAAV,EAAqB,UAArB,CAAJ;AACAF,wBAAIA,EAAEE,OAAF,CAAU,YAAV,EAAwB,YAAxB,CAAJ;AAED,iBATD,MASK;AACHJ,4BAAQC,GAAR,CAAY,QAAMrB,QAAQ,CAAR,CAAlB;AACA,wBAAIsB,IAAI7B,eAAe8B,iBAAf,CAAiCvB,QAAQ,CAAR,CAAjC,CAAR;AACAsB,wBAAIA,EAAEE,OAAF,CAAU,SAAV,EAAqB,UAArB,CAAJ;AACAF,wBAAIA,EAAEE,OAAF,CAAU,YAAV,EAAwB,YAAxB,CAAJ;AACD;AAEF,aAlBD,MAkBK;AACH,oBAAIF,IAAI,EAAR;AACD;;AAEDF,oBAAQC,GAAR,CAAYC,CAAZ;;AAEA,gBAAIG,MAAMb,IAAIc,MAAJ,CAAWJ,CAAX,CAAV;;AAEA,gBAAIK,UAAU,EAAd;AACA,gBAAIC,eAAe,EAAnB;;AAEA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIJ,IAAIR,MAAxB,EAAgCY,GAAhC,EAAqC;AACnCF,wBAAQG,IAAR,CAAaL,IAAII,CAAJ,EAAOE,GAApB;AACAH,6BAAaE,IAAb,CAAkBL,IAAII,CAAJ,EAAOG,KAAzB;AAED;;AAED,gBAAIC,KAAKxB,SAASE,IAAlB;AACA,gBAAIuB,WAAW,EAAf;;AAEA,iBAAK,IAAIL,IAAI,CAAb,EAAgBA,IAAII,GAAGhB,MAAvB,EAA+BY,GAA/B,EAAoC;;AAElC,oBAAIM,OAAO;AACPjC,mCAAe,IADR;AAEPF,6BAAS,IAFF;AAGPG,8BAAU,IAHH;AAIPC,qCAAiB,IAJV;AAKPC,8BAAU,IALH;AAMPC,qCAAiB;AANV,iBAAX;;AASA,oBAAGqB,QAAQS,QAAR,CAAiBH,GAAGJ,CAAH,EAAMQ,EAAvB,CAAH,EAA8B;;AAE5B,wBAAIC,QAAQX,QAAQY,OAAR,CAAgBN,GAAGJ,CAAH,EAAMQ,EAAtB,CAAZ;AACA,wBAAIL,QAAQJ,aAAaU,KAAb,CAAZ;;AAEA,wBAAI,CAAC5C,MAAMQ,aAAN,CAAL,EAA2B;AACvB,4BAAI,CAACA,cAAckC,QAAd,CAAuBH,GAAGJ,CAAH,EAAM3B,aAA7B,CAAL,EAAkD;AAC9CiC,iCAAKjC,aAAL,GAAqB,KAArB;AACH,yBAFD,MAEO;AACHiC,iCAAKjC,aAAL,GAAqB,IAArB;AACH;AACJ;;AAED,wBAAI,CAACR,MAAMS,QAAN,CAAL,EAAsB;AAClB,4BAAI,CAACA,SAASiC,QAAT,CAAkBH,GAAGJ,CAAH,EAAMW,IAAxB,CAAL,EAAoC;AAChCL,iCAAKhC,QAAL,GAAgB,KAAhB;AACH,yBAFD,MAEO;AACHgC,iCAAKhC,QAAL,GAAgB,IAAhB;AACH;AACJ;;AAED,wBAAI,CAACT,MAAMU,eAAN,CAAL,EAA6B;AACzB,4BAAI,CAACA,gBAAgBgC,QAAhB,CAAyBH,GAAGJ,CAAH,EAAMY,SAA/B,CAAL,EAAgD;AAC5CN,iCAAK/B,eAAL,GAAuB,KAAvB;AACH,yBAFD,MAEO;AACH+B,iCAAK/B,eAAL,GAAuB,IAAvB;AACH;AACJ;;AAED,wBAAI,CAACV,MAAMW,QAAN,CAAL,EAAsB;AAClB,6BAAK,IAAIqC,IAAE,CAAX,EAAaA,IAAErC,SAASY,MAAxB,EAA+ByB,GAA/B,EAAoC;AAChC,gCAAI,CAACT,GAAGJ,CAAH,EAAMc,QAAN,CAAeP,QAAf,CAAwB/B,SAASqC,CAAT,CAAxB,CAAL,EAA2C;AACvCP,qCAAK9B,QAAL,GAAgB,KAAhB;AACH,6BAFD,MAEO;AACH8B,qCAAK9B,QAAL,GAAgB,IAAhB;AACA;AACH;AACJ;AACJ;;AAED,wBAAI,CAACX,MAAMY,eAAN,CAAL,EAA6B;AACzB,4BAAI,CAACA,gBAAgB8B,QAAhB,CAAyBH,GAAGJ,CAAH,EAAMvB,eAA/B,CAAL,EAAsD;AAClD6B,iCAAK7B,eAAL,GAAuB,KAAvB;AACH,yBAFD,MAEO;AACH6B,iCAAK7B,eAAL,GAAuB,IAAvB;AACH;AACJ;;AAED,wBAAI6B,KAAKjC,aAAL,IAAsB,IAAtB,IAA8BiC,KAAKhC,QAAL,IAAiB,IAA/C,IAAuDgC,KAAK/B,eAAL,IAAwB,IAA/E,IAAuF+B,KAAK9B,QAAL,IAAiB,IAAxG,IAAgH8B,KAAK7B,eAAL,IAAwB,IAA5I,EAAkJ;;AAEhJ4B,iCAASJ,IAAT,CAAc;AACZ,kCAAMG,GAAGJ,CAAH,EAAMQ,EADA;AAEZ,oCAAQJ,GAAGJ,CAAH,EAAMe,IAFF;AAGZ,2CAAeX,GAAGJ,CAAH,EAAMgB,WAHT;AAIZ,6CAAiBZ,GAAGJ,CAAH,EAAMiB,aAJX;AAKZ,oCAAQb,GAAGJ,CAAH,EAAMW,IALF;AAMZ,uCAAWP,GAAGJ,CAAH,EAAMkB,OANL;AAOZ,wCAAYd,GAAGJ,CAAH,EAAMc,QAPN;AAQZ,+CAAmBV,GAAGJ,CAAH,EAAMvB,eARb;AASZ,qCAAS2B,GAAGJ,CAAH,EAAMmB,KATH;AAUZ,uCAAWf,GAAGJ,CAAH,EAAMoB,OAVL;AAWZ,sCAAUhB,GAAGJ,CAAH,EAAMqB,MAXJ;AAYZ,uCAAWjB,GAAGJ,CAAH,EAAMsB,OAZL;AAaZ,+CAAmBlB,GAAGJ,CAAH,EAAMuB,eAbb;AAcZ,6CAAiBnB,GAAGJ,CAAH,EAAM3B,aAdX;AAeZ,kDAAsB+B,GAAGJ,CAAH,EAAMwB,kBAfhB;AAgBZ,mDAAuBpB,GAAGJ,CAAH,EAAMyB,mBAhBjB;AAiBZ,+CAAmBrB,GAAGJ,CAAH,EAAM0B,eAjBb;AAkBZ,0CAActB,GAAGJ,CAAH,EAAM2B,UAlBR;AAmBZ,yCAAavB,GAAGJ,CAAH,EAAMY,SAnBP;AAoBZ,uCAAWR,GAAGJ,CAAH,EAAM4B,OApBL;AAqBZ,qCAASzB;AArBG,yBAAd;AAuBD;AAEF;AACF;;AAEDE,qBAASwB,IAAT,CAAc,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACzB;AACA,uBAAOD,EAAEL,mBAAF,GAAwBM,EAAEN,mBAAjC;AACH,aAHD;;AAKA,mBAAOxD,IAAI+D,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAQ,IAAxB,EAA6BrD,MAAKuB,QAAlC,EAArB,CAAP;AACD,SA1JH,EA2JG+B,KA3JH,CA2JSC,SAAS;AACd9C,oBAAQC,GAAR,CAAY6C,KAAZ;AACA,mBAAOpE,IAAI+D,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBI,SAAS,qBAAzB,EAArB,CAAP;AACD,SA9JH;AA+JD,KAxKD;;AA0KA,SAAKC,cAAL,GAAsB,UAASvE,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAE3C,YAAIC,UAAUH,IAAII,IAAJ,CAASD,OAAvB;AACA,YAAIE,gBAAgBL,IAAII,IAAJ,CAASC,aAA7B;AACA,YAAIC,WAAWN,IAAII,IAAJ,CAASE,QAAxB;AACA,YAAIC,kBAAkBP,IAAII,IAAJ,CAASG,eAA/B;AACA,YAAIC,WAAWR,IAAII,IAAJ,CAASI,QAAxB;AACA,YAAIC,kBAAkBT,IAAII,IAAJ,CAASK,eAA/B;;AAEAhB,cAAMiB,GAAN,CAAU,+CAAV,EACGC,IADH,CACQC,YAAY;;AAEhB,gBAAIC,YAAYD,SAASE,IAAzB;;AAEA,gBAAIC,MAAMpB,KAAK,YAAY;AACzB,qBAAKqB,KAAL,CAAW,MAAX;AACA,qBAAKA,KAAL,CAAW,eAAX;AACA,qBAAKA,KAAL,CAAW,MAAX;AACA,qBAAKA,KAAL,CAAW,UAAX;AACA,qBAAKA,KAAL,CAAW,iBAAX;AACA,qBAAKA,KAAL,CAAW,eAAX;AACA,qBAAKA,KAAL,CAAW,WAAX;AACA;;AAEAH,0BAAUI,OAAV,CAAkB,UAAUC,GAAV,EAAe;AAC/B,yBAAKC,GAAL,CAASD,GAAT;AACD,iBAFD,EAEG,IAFH;AAID,aAdS,CAAV;;AAgBA,gBAAG,CAACrB,MAAMM,OAAN,CAAJ,EAAmB;;AAEjB,oBAAGA,QAAQiB,MAAR,GAAiB,CAApB,EAAsB;;AAEpB,wBAAIC,MAAMlB,QAAQmB,IAAR,CAAa,GAAb,CAAV;;AAEAC,4BAAQC,GAAR,CAAY,QAAMH,GAAlB;AACA,wBAAII,IAAI7B,eAAe4E,iBAAf,CAAiCnD,GAAjC,CAAR;AACAI,wBAAIA,EAAEE,OAAF,CAAU,SAAV,EAAqB,UAArB,CAAJ;AACAF,wBAAIA,EAAEE,OAAF,CAAU,YAAV,EAAwB,YAAxB,CAAJ;AAED,iBATD,MASK;AACHJ,4BAAQC,GAAR,CAAY,QAAMrB,QAAQ,CAAR,CAAlB;AACA,wBAAIsB,IAAI7B,eAAe4E,iBAAf,CAAiCrE,QAAQ,CAAR,CAAjC,CAAR;AACAsB,wBAAIA,EAAEE,OAAF,CAAU,SAAV,EAAqB,UAArB,CAAJ;AACAF,wBAAIA,EAAEE,OAAF,CAAU,YAAV,EAAwB,YAAxB,CAAJ;AACD;AAEF,aAlBD,MAkBK;AACH,oBAAIF,IAAI,EAAR;AACD;;AAEDF,oBAAQC,GAAR,CAAYC,CAAZ;;AAEA,gBAAIG,MAAMb,IAAIc,MAAJ,CAAWJ,CAAX,CAAV;;AAEA,gBAAIK,UAAU,EAAd;AACA,gBAAIC,eAAe,EAAnB;;AAEA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIJ,IAAIR,MAAxB,EAAgCY,GAAhC,EAAqC;AACnCF,wBAAQG,IAAR,CAAaL,IAAII,CAAJ,EAAOE,GAApB;AACAH,6BAAaE,IAAb,CAAkBL,IAAII,CAAJ,EAAOG,KAAzB;AAED;;AAED,gBAAIC,KAAKxB,SAASE,IAAlB;AACA,gBAAIuB,WAAW,EAAf;;AAEA,iBAAK,IAAIL,IAAI,CAAb,EAAgBA,IAAII,GAAGhB,MAAvB,EAA+BY,GAA/B,EAAoC;;AAElC,oBAAIM,OAAO;AACPjC,mCAAe,IADR;AAEPF,6BAAS,IAFF;AAGPG,8BAAU,IAHH;AAIPC,qCAAiB,IAJV;AAKPC,8BAAU,IALH;AAMPC,qCAAiB;AANV,iBAAX;;AASA,oBAAGqB,QAAQS,QAAR,CAAiBH,GAAGJ,CAAH,EAAMQ,EAAvB,CAAH,EAA8B;;AAE5B,wBAAIC,QAAQX,QAAQY,OAAR,CAAgBN,GAAGJ,CAAH,EAAMQ,EAAtB,CAAZ;AACA,wBAAIL,QAAQJ,aAAaU,KAAb,CAAZ;;AAEA,wBAAI,CAAC5C,MAAMQ,aAAN,CAAL,EAA2B;AACvB,4BAAI,CAACA,cAAckC,QAAd,CAAuBH,GAAGJ,CAAH,EAAM3B,aAA7B,CAAL,EAAkD;AAC9CiC,iCAAKjC,aAAL,GAAqB,KAArB;AACH,yBAFD,MAEO;AACHiC,iCAAKjC,aAAL,GAAqB,IAArB;AACH;AACJ;;AAED,wBAAI,CAACR,MAAMS,QAAN,CAAL,EAAsB;AAClB,4BAAI,CAACA,SAASiC,QAAT,CAAkBH,GAAGJ,CAAH,EAAMW,IAAxB,CAAL,EAAoC;AAChCL,iCAAKhC,QAAL,GAAgB,KAAhB;AACH,yBAFD,MAEO;AACHgC,iCAAKhC,QAAL,GAAgB,IAAhB;AACH;AACJ;;AAED,wBAAI,CAACT,MAAMU,eAAN,CAAL,EAA6B;AACzB,4BAAI,CAACA,gBAAgBgC,QAAhB,CAAyBH,GAAGJ,CAAH,EAAMY,SAA/B,CAAL,EAAgD;AAC5CN,iCAAK/B,eAAL,GAAuB,KAAvB;AACH,yBAFD,MAEO;AACH+B,iCAAK/B,eAAL,GAAuB,IAAvB;AACH;AACJ;;AAED,wBAAI,CAACV,MAAMW,QAAN,CAAL,EAAsB;AAClB,6BAAK,IAAIqC,IAAE,CAAX,EAAaA,IAAErC,SAASY,MAAxB,EAA+ByB,GAA/B,EAAoC;AAChC,gCAAI,CAACT,GAAGJ,CAAH,EAAMc,QAAN,CAAeP,QAAf,CAAwB/B,SAASqC,CAAT,CAAxB,CAAL,EAA2C;AACvCP,qCAAK9B,QAAL,GAAgB,KAAhB;AACH,6BAFD,MAEO;AACH8B,qCAAK9B,QAAL,GAAgB,IAAhB;AACA;AACH;AACJ;AACJ;;AAED,wBAAI,CAACX,MAAMY,eAAN,CAAL,EAA6B;AACzB,4BAAI,CAACA,gBAAgB8B,QAAhB,CAAyBH,GAAGJ,CAAH,EAAMvB,eAA/B,CAAL,EAAsD;AAClD6B,iCAAK7B,eAAL,GAAuB,KAAvB;AACH,yBAFD,MAEO;AACH6B,iCAAK7B,eAAL,GAAuB,IAAvB;AACH;AACJ;;AAED,wBAAI6B,KAAKjC,aAAL,IAAsB,IAAtB,IAA8BiC,KAAKhC,QAAL,IAAiB,IAA/C,IAAuDgC,KAAK/B,eAAL,IAAwB,IAA/E,IAAuF+B,KAAK9B,QAAL,IAAiB,IAAxG,IAAgH8B,KAAK7B,eAAL,IAAwB,IAA5I,EAAkJ;;AAEhJ4B,iCAASJ,IAAT,CAAc;AACZ,kCAAMG,GAAGJ,CAAH,EAAMQ,EADA;AAEZ,oCAAQJ,GAAGJ,CAAH,EAAMe,IAFF;AAGZ,2CAAeX,GAAGJ,CAAH,EAAMgB,WAHT;AAIZ,6CAAiBZ,GAAGJ,CAAH,EAAMiB,aAJX;AAKZ,oCAAQb,GAAGJ,CAAH,EAAMW,IALF;AAMZ,uCAAWP,GAAGJ,CAAH,EAAMkB,OANL;AAOZ,wCAAYd,GAAGJ,CAAH,EAAMc,QAPN;AAQZ,+CAAmBV,GAAGJ,CAAH,EAAMvB,eARb;AASZ,qCAAS2B,GAAGJ,CAAH,EAAMmB,KATH;AAUZ,uCAAWf,GAAGJ,CAAH,EAAMoB,OAVL;AAWZ,sCAAUhB,GAAGJ,CAAH,EAAMqB,MAXJ;AAYZ,uCAAWjB,GAAGJ,CAAH,EAAMsB,OAZL;AAaZ,+CAAmBlB,GAAGJ,CAAH,EAAMuB,eAbb;AAcZ,6CAAiBnB,GAAGJ,CAAH,EAAM3B,aAdX;AAeZ,kDAAsB+B,GAAGJ,CAAH,EAAMwB,kBAfhB;AAgBZ,mDAAuBpB,GAAGJ,CAAH,EAAMyB,mBAhBjB;AAiBZ,+CAAmBrB,GAAGJ,CAAH,EAAM0B,eAjBb;AAkBZ,0CAActB,GAAGJ,CAAH,EAAM2B,UAlBR;AAmBZ,yCAAavB,GAAGJ,CAAH,EAAMY,SAnBP;AAoBZ,uCAAWR,GAAGJ,CAAH,EAAM4B,OApBL;AAqBZ,qCAASzB;AArBG,yBAAd;AAuBD;AAEF;AACF;;AAEDE,qBAASwB,IAAT,CAAc,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACzB;AACA,uBAAOD,EAAEL,mBAAF,GAAwBM,EAAEN,mBAAjC;AACH,aAHD;;AAKA,mBAAOxD,IAAI+D,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAQ,IAAxB,EAA6BrD,MAAKuB,QAAlC,EAArB,CAAP;AACD,SA1JH,EA2JG+B,KA3JH,CA2JSC,SAAS;AACd9C,oBAAQC,GAAR,CAAY6C,KAAZ;AACA,mBAAOpE,IAAI+D,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBI,SAAS,qBAAzB,EAArB,CAAP;AACD,SA9JH;AA+JD,KAxKD;;AA0KA,SAAKG,UAAL,GAAkB,UAASzE,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAEvC,YAAIW,YACJ,CACE;AACE,qBAAS,WADX;AAEE,oBAAQ,oDAFV;AAGE,uBAAW,SAHb;AAIE,oBAAQ,CAAC,MAAD,EAAQ,MAAR,CAJV;AAKE,kBAAM;AALR,SADF,EAQE;AACE,qBAAS,WADX;AAEE,oBAAQ,oDAFV;AAGE,sBAAU,gBAHZ;AAIE,oBAAQ,CAAC,MAAD,EAAQ,MAAR,CAJV;AAKE,kBAAM;AALR,SARF,EAeE;AACE,qBAAS,QADX;AAEE,oBAAQ,4EAFV;AAGE,sBAAU,MAHZ;AAIE,oBAAQ,CAAC,MAAD,EAAQ,MAAR,CAJV;AAKE,kBAAM;AALR,SAfF,CADA;;AA0BA,YAAIE,MAAMpB,KAAK,YAAY;AACzB,iBAAKqB,KAAL,CAAW,OAAX;AACA,iBAAKA,KAAL,CAAW,MAAX;AACA,iBAAKA,KAAL,CAAW,MAAX;;AAEAH,sBAAUI,OAAV,CAAkB,UAAUC,GAAV,EAAe;AAC/B,qBAAKC,GAAL,CAASD,GAAT;AACD,aAFD,EAEG,IAFH;AAID,SATS,CAAV;;AAWA,YAAIwD,SAAS,oDAAb;;AAEA,YAAI9C,MAAMb,IAAIc,MAAJ,CAAW,oDAAX,CAAV;;AAEA,YAAIgB,IAAIjD,eAAe8B,iBAAf,CAAiCgD,MAAjC,CAAR;;AAEA,eAAOzE,IAAI+D,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAQ,IAAxB,EAA6BrD,MAAK+B,CAAlC,EAArB,CAAP;AAED,KA/CD;AAmDD;AACD8B,OAAOC,OAAP,GAAiB,IAAI9E,OAAJ,EAAjB","file":"search.js","sourcesContent":["const axios = require('axios');\nconst lunr = require('lunr');\n\nvar textProcessing = require('../models/textprocess');\nvar empty = require('is-empty');\n \nfunction cSearch() {\n  \n  this.searchAction = function(req,res,next) {\n\n    var keyword = req.body.keyword;\n    var businessModel = req.body.businessModel;\n    var location = req.body.location;\n    var roundInvestment = req.body.roundInvestment;\n    var vertical = req.body.vertical;\n    var yearEstablished = req.body.yearEstablished;\n\n    axios.get('https://minerva.dailysocial.id/sampoerna.json')\n      .then(response => {\n\n        var documents = response.data;\n\n        var idx = lunr(function () {\n          this.field('name')\n          this.field('description')\n          this.field('city')\n          this.field('category')\n          this.field('yearEstablished')\n          this.field('businessModel')\n          this.field('lastRound')\n          //this.ref('name')\n\n          documents.forEach(function (doc) {\n            this.add(doc)\n          }, this)\n         \n        });\n\n        if(!empty(keyword)){\n\n          if(keyword.length > 1){\n\n            var arr = keyword.join(\" \");\n\n            console.log(\"1: \"+arr);\n            var q = textProcessing.removeStopwordsID(arr);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n\n          }else{\n            console.log(\"2: \"+keyword[0]);\n            var q = textProcessing.removeStopwordsID(keyword[0]);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n          }\n\n        }else{\n          var q = \"\";\n        }\n\n        console.log(q);\n\n        var ret = idx.search(q);\n\n        var resLunr = [];\n        var resLunrScore = [];\n\n        for (var i = 0; i < ret.length; i++) {\n          resLunr.push(ret[i].ref);\n          resLunrScore.push(ret[i].score);\n\n        }\n\n        var dt = response.data;\n        var finalRet = [];\n\n        for (var i = 0; i < dt.length; i++) {\n\n          var pass = {\n              businessModel: true, \n              keyword: true, \n              location: true, \n              roundInvestment: true, \n              vertical: true, \n              yearEstablished: true\n          };\n          \n          if(resLunr.includes(dt[i].id)){\n\n            var index = resLunr.indexOf(dt[i].id);\n            var score = resLunrScore[index];\n\n            if (!empty(businessModel)) {\n                if (!businessModel.includes(dt[i].businessModel)) {\n                    pass.businessModel = false;\n                } else {\n                    pass.businessModel = true;                                    \n                }\n            }\n\n            if (!empty(location)) {\n                if (!location.includes(dt[i].city)) {\n                    pass.location = false;\n                } else {\n                    pass.location = true;                                    \n                }\n            }\n\n            if (!empty(roundInvestment)) {\n                if (!roundInvestment.includes(dt[i].lastRound)) {\n                    pass.roundInvestment = false;\n                } else {\n                    pass.roundInvestment = true;                                    \n                }\n            }\n\n            if (!empty(vertical)) {\n                for (var x=0;x<vertical.length;x++) {\n                    if (!dt[i].category.includes(vertical[x])) {\n                        pass.vertical = false;\n                    } else {\n                        pass.vertical = true;\n                        break;                                        \n                    }\n                }\n            }\n\n            if (!empty(yearEstablished)) {\n                if (!yearEstablished.includes(dt[i].yearEstablished)) {\n                    pass.yearEstablished = false;\n                } else {\n                    pass.yearEstablished = true;                                    \n                }\n            }\n\n            if (pass.businessModel == true && pass.location == true && pass.roundInvestment == true && pass.vertical == true && pass.yearEstablished == true) {\n\n              finalRet.push({\n                \"id\": dt[i].id,\n                \"name\": dt[i].name,\n                \"description\": dt[i].description,\n                \"descriptionEn\": dt[i].descriptionEn,\n                \"city\": dt[i].city,\n                \"country\": dt[i].country,\n                \"category\": dt[i].category,\n                \"yearEstablished\": dt[i].yearEstablished,\n                \"notes\": dt[i].notes,\n                \"website\": dt[i].website,\n                \"avatar\": dt[i].avatar,\n                \"urlNews\": dt[i].urlNews,\n                \"operationStatus\": dt[i].operationStatus,\n                \"businessModel\": dt[i].businessModel,\n                \"provenRevenueModel\": dt[i].provenRevenueModel,\n                \"provenBusinessModel\": dt[i].provenBusinessModel,\n                \"editorialRating\": dt[i].editorialRating,\n                \"investment\": dt[i].investment,\n                \"lastRound\": dt[i].lastRound,\n                \"founder\": dt[i].founder,\n                \"score\": score\n              });\n            }\n\n          } \n        }\n\n        finalRet.sort(function(a, b) {\n            //return parseFloat(b.score) - parseFloat(a.score);\n            return a.provenBusinessModel < b.provenBusinessModel;\n        });\n\n        return res.status(200).json({statusCode:200,success:true,data:finalRet});\n      })\n      .catch(error => {\n        console.log(error);\n        return res.status(500).json({statusCode:500,message: \"Read search failed.\"});\n      });\n  };\n\n  this.searchEnAction = function(req,res,next) {\n\n    var keyword = req.body.keyword;\n    var businessModel = req.body.businessModel;\n    var location = req.body.location;\n    var roundInvestment = req.body.roundInvestment;\n    var vertical = req.body.vertical;\n    var yearEstablished = req.body.yearEstablished;\n\n    axios.get('https://minerva.dailysocial.id/sampoerna.json')\n      .then(response => {\n\n        var documents = response.data;\n\n        var idx = lunr(function () {\n          this.field('name')\n          this.field('descriptionEn')\n          this.field('city')\n          this.field('category')\n          this.field('yearEstablished')\n          this.field('businessModel')\n          this.field('lastRound')\n          //this.ref('name')\n\n          documents.forEach(function (doc) {\n            this.add(doc)\n          }, this)\n         \n        });\n\n        if(!empty(keyword)){\n\n          if(keyword.length > 1){\n\n            var arr = keyword.join(\" \");\n\n            console.log(\"1: \"+arr);\n            var q = textProcessing.removeStopwordsEN(arr);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n\n          }else{\n            console.log(\"2: \"+keyword[0]);\n            var q = textProcessing.removeStopwordsEN(keyword[0]);\n            q = q.replace(/gudang/g, \"*gudang*\");\n            q = q.replace(/ecommerce/g, \"e-commerce\");\n          }\n\n        }else{\n          var q = \"\";\n        }\n\n        console.log(q);\n\n        var ret = idx.search(q);\n\n        var resLunr = [];\n        var resLunrScore = [];\n\n        for (var i = 0; i < ret.length; i++) {\n          resLunr.push(ret[i].ref);\n          resLunrScore.push(ret[i].score);\n\n        }\n\n        var dt = response.data;\n        var finalRet = [];\n\n        for (var i = 0; i < dt.length; i++) {\n\n          var pass = {\n              businessModel: true, \n              keyword: true, \n              location: true, \n              roundInvestment: true, \n              vertical: true, \n              yearEstablished: true\n          };\n          \n          if(resLunr.includes(dt[i].id)){\n\n            var index = resLunr.indexOf(dt[i].id);\n            var score = resLunrScore[index];\n\n            if (!empty(businessModel)) {\n                if (!businessModel.includes(dt[i].businessModel)) {\n                    pass.businessModel = false;\n                } else {\n                    pass.businessModel = true;                                    \n                }\n            }\n\n            if (!empty(location)) {\n                if (!location.includes(dt[i].city)) {\n                    pass.location = false;\n                } else {\n                    pass.location = true;                                    \n                }\n            }\n\n            if (!empty(roundInvestment)) {\n                if (!roundInvestment.includes(dt[i].lastRound)) {\n                    pass.roundInvestment = false;\n                } else {\n                    pass.roundInvestment = true;                                    \n                }\n            }\n\n            if (!empty(vertical)) {\n                for (var x=0;x<vertical.length;x++) {\n                    if (!dt[i].category.includes(vertical[x])) {\n                        pass.vertical = false;\n                    } else {\n                        pass.vertical = true;\n                        break;                                        \n                    }\n                }\n            }\n\n            if (!empty(yearEstablished)) {\n                if (!yearEstablished.includes(dt[i].yearEstablished)) {\n                    pass.yearEstablished = false;\n                } else {\n                    pass.yearEstablished = true;                                    \n                }\n            }\n\n            if (pass.businessModel == true && pass.location == true && pass.roundInvestment == true && pass.vertical == true && pass.yearEstablished == true) {\n\n              finalRet.push({\n                \"id\": dt[i].id,\n                \"name\": dt[i].name,\n                \"description\": dt[i].description,\n                \"descriptionEn\": dt[i].descriptionEn,\n                \"city\": dt[i].city,\n                \"country\": dt[i].country,\n                \"category\": dt[i].category,\n                \"yearEstablished\": dt[i].yearEstablished,\n                \"notes\": dt[i].notes,\n                \"website\": dt[i].website,\n                \"avatar\": dt[i].avatar,\n                \"urlNews\": dt[i].urlNews,\n                \"operationStatus\": dt[i].operationStatus,\n                \"businessModel\": dt[i].businessModel,\n                \"provenRevenueModel\": dt[i].provenRevenueModel,\n                \"provenBusinessModel\": dt[i].provenBusinessModel,\n                \"editorialRating\": dt[i].editorialRating,\n                \"investment\": dt[i].investment,\n                \"lastRound\": dt[i].lastRound,\n                \"founder\": dt[i].founder,\n                \"score\": score\n              });\n            }\n\n          } \n        }\n\n        finalRet.sort(function(a, b) {\n            //return parseFloat(b.score) - parseFloat(a.score);\n            return a.provenBusinessModel < b.provenBusinessModel;\n        });\n\n        return res.status(200).json({statusCode:200,success:true,data:finalRet});\n      })\n      .catch(error => {\n        console.log(error);\n        return res.status(500).json({statusCode:500,message: \"Read search failed.\"});\n      });\n  };\n\n  this.lunrAction = function(req,res,next) {\n\n    var documents = \n    [\n      {\n        \"title\": \"Tokopedia\",\n        \"body\": \"Tokopedia adalah marketplace terbesar di Indonesia\",\n        \"founder\": \"William\",\n        \"year\": [\"2014\",\"2017\"],\n        \"id\": \"0jkuyvbc78m\"\n      }, \n      {\n        \"title\": \"Traveloka\",\n        \"body\": \"Traveloka adalah platform hospitality di Indonesia\",\n        \"author\": \"Bagus Rinaldhi\",\n        \"year\": [\"2015\",\"2017\"],\n        \"id\": \"0jkuyvbc78r\"\n      }, \n      {\n        \"title\": \"Lazada\",\n        \"body\": \"Lazada merupakan platform e-commerce yang memberikan layanan gratis ongkir\",\n        \"author\": \"Bens\",\n        \"year\": [\"2016\",\"2018\"],\n        \"id\": \"0jkuyvbc78f\"\n      }\n    ]\n\n\n    var idx = lunr(function () {\n      this.field('title')\n      this.field('body')\n      this.field('year');\n\n      documents.forEach(function (doc) {\n        this.add(doc)\n      }, this)\n     \n    });\n\n    var string = \"saya ingin tahu startup hospitality 2018 2014 2015\";\n\n    var ret = idx.search(\"saya ingin tahu startup hospitality 2018 2014 2015\");\n\n    var x = textProcessing.removeStopwordsID(string)\n\n    return res.status(200).json({statusCode:200,success:true,data:x});\n\n  };\n\n  \n\n}\nmodule.exports = new cSearch();"]}